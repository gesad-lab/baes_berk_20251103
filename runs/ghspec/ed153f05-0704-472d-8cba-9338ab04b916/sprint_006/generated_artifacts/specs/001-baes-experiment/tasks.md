# Tasks: Add Teacher Relationship to Course Entity

---
INCREMENTAL DEVELOPMENT CONTEXT

Existing Code to Build Upon:
- `src/models.py` (2133 bytes)
- `src/schemas.py` (1837 bytes)
- `src/routes.py` (1234 bytes)
- `tests/test_routes.py` (462 bytes)
- `tests/test_models.py` (341 bytes)

---

## Task Breakdown

### 1. Setup Environment
- **Task**: Ensure the `.env` file is updated with necessary configuration settings.
  - **File**: `/.env`  
  - [ ] Update `.env` to include any new environment variables related to course-teacher relationships.

### 2. Update the Model
- **Task**: Update the `Course` model to include a foreign key to the `Teacher`.
  - **File**: `/src/models.py`  
  ```python
  # Add teacher_id field to Course model
  class Course(db.Model):
      ...
      teacher_id = db.Column(db.Integer, db.ForeignKey('teachers.id'), nullable=True)  # New field
  ```
  - [ ] Modify `models.py` to include the `teacher_id` foreign key.

### 3. Database Migration
- **Task**: Create a migration script for adding the `teacher_id` column to the `courses` table.
  - **File**: `migration_script.py` (generated by Flask-Migrate)  
  ```bash
  flask db migrate -m "Add teacher_id to courses table"
  flask db upgrade
  ```
  - [ ] Generate and apply the migration script.

### 4. Update Marshmallow Schemas
- **Task**: Update the existing `CourseSchema` to include `teacher_id`.
  - **File**: `/src/schemas.py`  
  ```python
  class CourseSchema(ma.SQLAlchemyAutoSchema):
      class Meta:
          model = Course
          include_fk = True  # Include foreign key
  ```
  - [ ] Modify `schemas.py` to ensure `teacher_id` is serialized.

### 5. Add API Endpoint Logic
- **Task**: Update the `POST /courses` endpoint to handle teacher assignment.
  - **File**: `/src/routes.py`  
  ```python
  @app.route('/courses', methods=['POST'])
  def create_course():
      ...
      new_course = Course(course_name=data['course_name'], teacher_id=data.get('teacher_id'))
  ```
  - [ ] Implement the logic for creating a course with an optional teacher assignment.

- **Task**: Update the `PUT /courses/{id}` endpoint to assign a teacher.
  - **File**: `/src/routes.py`  
  ```python
  @app.route('/courses/<int:id>', methods=['PUT'])
  def update_course(id):
      ...
      course.teacher_id = teacher_id  # Set the teacher ID
  ```
  - [ ] Implement the logic for updating the course with the assigned teacher.

### 6. Implement Error Handling and Validation
- **Task**: Ensure all error responses are structured correctly for teacher assignments.
  - **File**: `/src/routes.py`  
  - [ ] Modify the routes.py logic to handle validation for non-existent teacher assignments properly.

### 7. Testing
- **Task**: Write unit tests for the updated `Course` model to include the teacher relationship.
  - **File**: `/tests/test_models.py`  
  - [ ] Create tests to validate functionality of `Course` model with `teacher_id`.

- **Task**: Write integration tests for the updated `POST /courses` endpoint.
  - **File**: `/tests/test_routes.py`  
  - [ ] Add tests to ensure that creating a course with a valid teacher ID works as expected.

- **Task**: Write integration tests for the updated `PUT /courses/{id}` endpoint.
  - **File**: `/tests/test_routes.py`  
  - [ ] Add tests to ensure updating a course to assign a teacher is functioning properly.

### 8. Documentation
- **Task**: Update the README.md file to reflect changes regarding teacher assignments.
  - **File**: `/README.md`  
  - [ ] Add details about the new functionality for the teacher assignments to courses.

---

### Summary of Actions
- Ensure environment is configured
- Modify course model and migrate database
- Update serialization schema
- Implement API endpoints
- Careful implementation of error handling
- Comprehensive testing strategy
- Update core documentation for clarity