# Tasks: Add Course Relationship to Student Entity

---
INCREMENTAL DEVELOPMENT CONTEXT

Existing Code to Build Upon:
- `tests/test_routes.py` (1716 bytes)
- `tests/test_models.py` (2012 bytes)

Instructions for Task Breakdown:
1. Identify which existing files need modifications
2. Create new files for new functionality
3. Ensure integration tasks are included
4. Maintain consistency with existing code style and patterns

---

## Task Breakdown

### 1. Setup Environment
- [ ] **Ensure Environment is Ready**  
  **File**: `./.env`  
  **Description**: Update the `.env` file with any necessary configuration settings for database connections and Flask.

### 2. Update the Model
- [ ] **Create StudentCourse Model**  
  **File**: `./src/models.py`  
  **Description**: Add a new `StudentCourse` model to handle the many-to-many relationship between students and courses.  
  ```python
  class StudentCourse(db.Model):
      __tablename__ = 'student_courses'
      student_id = db.Column(db.Integer, db.ForeignKey('students.id'), primary_key=True)
      course_id = db.Column(db.Integer, db.ForeignKey('courses.id'), primary_key=True)
  ```

### 3. Database Migration
- [ ] **Implement Migration for Join Table**  
  **File**: `n/a` (migration script generated by Flask-Migrate)  
  **Description**: Use `Flask-Migrate` to create a migration script that adds the `student_courses` table.  
  ```bash
  flask db migrate -m "Add student_courses join table"
  flask db upgrade
  ```

### 4. Update Marshmallow Schemas
- [ ] **Add StudentCourse Schema**  
  **File**: `./src/schemas.py`  
  **Description**: Define a new schema for `StudentCourse` to validate and serialize relationship data.  
  ```python
  class StudentCourseSchema(ma.SQLAlchemyAutoSchema):
      class Meta:
          model = StudentCourse
          fields = ("student_id", "course_id")
  ```

### 5. Add API Endpoints
- [ ] **Implement Enrollment Endpoint**  
  **File**: `./src/routes.py`  
  **Description**: Write the logic for the `POST /students/{id}/courses` endpoint to enroll a student in a course.  
- [ ] **Implement Retrieve Courses Endpoint**  
  **File**: `./src/routes.py`  
  **Description**: Write the logic for the `GET /students/{id}/courses` endpoint to retrieve the list of courses for a specific student.  
  ```python
  @app.route('/students/<int:id>/courses', methods=['POST'])
  def enroll_student_in_course(id):
      ...

  @app.route('/students/<int:id>/courses', methods=['GET'])
  def get_student_courses(id):
      ...
  ```

### 6. Implement Error Handling and Validation
- [ ] **Add Validation Logic**  
  **File**: `./src/routes.py`  
  **Description**: Ensure proper error handling for scenarios where a student is not found during course enrollment. Return structured error responses.  

### 7. Testing
- [ ] **Write Integration Tests for API Endpoints**  
  **File**: `./tests/test_routes.py`  
  **Description**: Create tests for the course enrollment and retrieval endpoints, ensuring status codes and response messages are as expected.  
- [ ] **Write Unit Tests for StudentCourse Model**  
  **File**: `./tests/test_models.py`  
  **Description**: Write tests to confirm the functionality of the `StudentCourse` model.  

### 8. Documentation
- [ ] **Update README.md**  
  **File**: `./README.md`  
  **Description**: Provide details about new course enrollment functionality and how to use the new API endpoints.  
- [ ] **Update API Docs**  
  **File**: `./docs/api_documentation.yaml` (or equivalent)  
  **Description**: Ensure the API documentation is updated to reflect the new endpoints and their expected request/response formats.

---

## Summary of Modifications by File
- **models.py**: Added a new `StudentCourse` class to define relationships.
- **schemas.py**: Included a schema for `StudentCourse` for data validation.
- **routes.py**: Implemented two new API endpoints for managing student course relationships.
- **tests/test_routes.py**: Created unit and integration tests for the API endpoints.
- **tests/test_models.py**: Created tests for the `StudentCourse` model functionality.