```markdown
# Implementation Plan: Add Teacher Relationship to Course Entity

---
## INCREMENTAL DEVELOPMENT CONTEXT

Previous Sprint Plan:
# Implementation Plan: Create Teacher Entity

---
## INCREMENTAL DEVELOPMENT CONTEXT

Previous Sprint Plan:
# Implementation Plan: Add Course Relationship to Student Entity

---
## INCREMENTAL DEVELOPMENT CONTEXT

Previous Sprint Plan:
# Implementation Plan: Create Course Entity with Name and Level Fields

---
## INCREMENTAL DEVELOPMENT CONTEXT

Previous Sprint Plan:
# Implementation Plan: Add Email Field to Student Entity

---
## INCREMENTAL DEVELOPMENT CONTEXT

Previous Sprint Plan:
# Implementation Plan: Student Entity Management Web Application

## I. Project Overview

### 1.1 Purpose
The purpose of this implementation is to enhance the existing Student Entity Management Web Application by establishing a relationship between the Course and Teacher entities. By enabling each course to have a designated teacher, the application will better manage educational resources and improve tracking capabilities.

### 1.2 Goals
- Update the Course table schema to include a foreign key reference to the Teacher entity.
- Implement API endpoints for assigning teachers to courses and retrieving courses with their assigned teacher.
- Ensure existing course and student data remain intact and unaffected by this addition.

---

## II. Technical Architecture

### 2.1 Architecture Overview
- **Architecture Type**: Microservices-based architecture as previously maintained.
- **Service Layer**: Extend to include functionality for assigning teachers to courses.
- **API Layer**: Implement RESTful endpoints for course-teacher relationships.
- **Database**: SQLite, updated to accommodate the Teacher_ID foreign key in the Course table.

### 2.2 Tech Stack
- **Programming Language**: Python 3.11+
- **Framework**: FastAPI for asynchronous request handling.
- **Database**: SQLite for lightweight data storage.
- **ORM**: SQLAlchemy for database interaction.
- **Testing**: Pytest for unit and integration tests.
- **Documentation**: OpenAPI spec generated by FastAPI.

---

## III. Module Boundaries and Responsibilities

### 3.1 API Layer
- **Endpoints**:
  - `PATCH /courses/{course_id}/assign-teacher`: Assign a teacher to an existing course.
  - `GET /courses/{course_id}`: Retrieve course details, including the assigned teacher information.

### 3.2 Service Layer
- Implement methods in the service layer to handle course-teacher assignments:
  - **assign_teacher_to_course**: Validates teacher ID and updates the course record.
  - **get_course_with_teacher**: Retrieves course details, including the assigned teacher.

### 3.3 Database Layer
- Update the Course table to include the Teacher_ID field:
  - Teacher_ID (integer, foreign key referencing Teacher, nullable)

---

## IV. Data Model

### 4.1 Updated Course Table
```python
from sqlalchemy import Column, Integer, String, ForeignKey
from sqlalchemy.orm import relationship
from database import Base

class Course(Base):
    __tablename__ = 'courses'
    
    id = Column(Integer, primary_key=True, index=True, autoincrement=True)
    name = Column(String, nullable=False)
    level = Column(String, nullable=False)
    teacher_id = Column(Integer, ForeignKey('teachers.id'), nullable=True)  # New relationship field

    teacher = relationship("Teacher", back_populates="courses")  # Define relationship
```

### 4.2 Teacher Table (Already Defined)
Already established in the previous implementation.

### 4.3 SQLite Schema Migration
- Create a migration script to update the Course table:
```sql
ALTER TABLE courses ADD COLUMN teacher_id INTEGER REFERENCES teachers(id);
```
- Ensure proper indexing and foreign key relationships to maintain data integrity.

---

## V. API Contracts

### 5.1 Request/Response Formats

1. **Assign Teacher to Course**
   - **Request**:
     - Method: PATCH
     - URL: `/courses/{course_id}/assign-teacher`
     - Body: `{"teacher_id": 1}`
   - **Response**:
     - Status: 204 No Content

2. **Retrieve Course with Assigned Teacher**
   - **Request**:
     - Method: GET
     - URL: `/courses/{course_id}`
   - **Response**:
     - Status: 200 OK
     - Body: `{"id": 1, "name": "Math 101", "level": "Beginner", "teacher_id": 1}`

### 5.2 Error Handling
- Possible responses with status codes:
  - 400 Bad Request: for invalid teacher ID (non-existent)
  - 404 Not Found: for course ID not existing.

---

## VI. Implementation Strategy

### 6.1 Development Phases
1. **Setup Development Environment**
   - Ensure compatibility with Python 3.11+, FastAPI, SQLAlchemy, and Pytest.

2. **Modify API Layer**
   - Implement new endpoint for assigning a teacher to a course:
   ```python
   @app.patch("/courses/{course_id}/assign-teacher", response_model=None)
   async def assign_teacher_to_course(course_id: int, teacher_id: int, db: Session = Depends(get_db)):
       return assign_teacher_to_course(course_id, teacher_id, db)
   ```

3. **Implement Service Layer Logic**
   - Create new service method for assigning a teacher to a course:
     ```python
     def assign_teacher_to_course(course_id: int, teacher_id: int, db: Session) -> None:
         course = db.query(Course).filter(Course.id == course_id).first()
         if course is None:
             raise HTTPException(status_code=404, detail="Course not found")
         
         teacher = db.query(Teacher).filter(Teacher.id == teacher_id).first()
         if teacher is None:
             raise HTTPException(status_code=400, detail="Teacher not found")
         
         course.teacher_id = teacher_id
         db.commit()
     ```

4. **Database Initialization and Migration**
   - Write migration scripts to update the `courses` table by adding `teacher_id`.
   - Verify that the application initializes correctly with migrated tables.

5. **Testing**
   - Write unit tests for service functions and integrated API tests to validate endpoint functionality:
     ```python
     def test_assign_teacher_to_course(test_client):
         response = test_client.patch("/courses/1/assign-teacher", json={"teacher_id": 1})
         assert response.status_code == 204
     ```

6. **Documentation**
   - Update OpenAPI documentation to reflect the new endpoints and data models for course-teacher relationships.

### 6.2 Code Review & Validation
- Follow coding standards, ensure appropriate validation and documentation are in place, and check for comprehensive test coverage.

---

## VII. Testing Strategy

### 7.1 Unit Tests
- Implement unit tests for service functions pertaining to course-teacher assignments.

### 7.2 Integration Tests
- Validate integration by assigning a teacher to a course and integrating that data into course retrieval.

### 7.3 Test Coverage
- Aim for over 70% coverage on the new business logic surrounding the course-teacher assignments, with critical paths achieving over 90%.

### 7.4 Test Scenarios
1. Test assigning a teacher to a course with valid data.
2. Validate error responses for invalid teacher IDs.
3. Confirm retrieval of course details with assigned teacher data included.

---

## VIII. Security Considerations

- Validate input in all endpoints to avoid injection vulnerabilities and protect against data inconsistency.
- Ensure that only valid teacher IDs can be assigned to courses.

---

## IX. Deployment Considerations

- Document required environment configurations and migration steps necessary for deployment.
- Ensure migrations are executed smoothly, maintaining service continuity, and without data loss.

---

## X. Conclusion

This implementation plan details the steps necessary to create a relationship between the Course and Teacher entities within the Student Entity Management Web Application. By adhering to the established architecture and emphasizing input validation, data integrity, and thorough testing, we aim to enhance the applicationâ€™s capability to manage educational resources efficiently.

### Modifications Needed to Existing Files
- **Model Changes**: Modify the `Course` model class in `src/models` to include `teacher_id`.
- **Migration Handling**: Introduce migration files for updating the `courses` table.
- **API Endpoints**: Extend FastAPI routes to include the new methods for course-teacher assignments.
- **Testing Files**: Create or extend `tests/api/test_course_api.py` and `tests/service/test_course_service.py` to include tests for course functionalities.

This structured approach will allow for a successful integration of the Teacher relationship while maintaining system stability and user experience.

Current Code Files:
- `tests/api/test_course_api.py`: Add tests for course-teacher assignment endpoints.
- `tests/service/test_course_service.py`: Add tests for service functions involving course-teacher relationships.
```