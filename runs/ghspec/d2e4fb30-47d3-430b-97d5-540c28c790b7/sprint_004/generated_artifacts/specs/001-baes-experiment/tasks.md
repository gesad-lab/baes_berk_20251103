# Tasks: Add Course Relationship to Student Entity

---
INCREMENTAL DEVELOPMENT CONTEXT

Existing Code to Build Upon:
- tests/test_courses.py (1910 bytes)

---

## Task List

### Database Schema Management

- [ ] **Create the Student-Course Linking Table Model**
  - **File**: `src/models/student_course.py`
  - **Description**: Implement the `StudentCourse` model to establish the many-to-many relationship between `Student` and `Course`.
  ```python
  from sqlalchemy import Column, ForeignKey
  from sqlalchemy.orm import relationship
  from . import Base

  class StudentCourse(Base):
      __tablename__ = 'student_courses'
      
      student_id = Column(Integer, ForeignKey('students.id'), primary_key=True)
      course_id = Column(Integer, ForeignKey('courses.id'), primary_key=True)

      student = relationship("Student", back_populates="courses")
      course = relationship("Course", back_populates="students")
  ```

- [ ] **Create Database Migration for `student_courses` Table**
  - **File**: `migrations/versions/XXXXXXXXXXXXXX_add_student_course_relationship.py`
  - **Description**: Write an Alembic migration script to add the `student_courses` table. Include code for the `upgrade()` and `downgrade()` methods.
  ```python
  def upgrade():
      op.create_table(
          'student_courses',
          sa.Column('student_id', sa.Integer(), sa.ForeignKey('students.id'), nullable=False),
          sa.Column('course_id', sa.Integer(), sa.ForeignKey('courses.id'), nullable=False),
          sa.PrimaryKeyConstraint('student_id', 'course_id')
      )

  def downgrade():
      op.drop_table('student_courses')
  ```

### API Development

- [ ] **Develop API Routes for Course Assignment**
  - **File**: `src/routes/student.py`
  - **Description**: Implement the `assign_courses` and `retrieve_courses` endpoints following the provided API contracts.
  ```python
  from fastapi import APIRouter, HTTPException, Depends
  from sqlalchemy.orm import Session
  from ..models import Course, Student, StudentCourse
  from ..database import get_db

  router = APIRouter()
  
  @router.post("/students/{student_id}/courses")
  async def assign_courses(student_id: int, course_assignment: CourseAssignment, db: Session = Depends(get_db)):
      # Implementation details
     
  @router.get("/students/{student_id}/courses")
  async def get_courses(student_id: int, db: Session = Depends(get_db)):
      # Implementation details
  ```

### Testing

- [ ] **Create Unit Tests for New API Endpoints**
  - **File**: `tests/test_students.py`
  - **Description**: Write tests to ensure course assignments and retrieval functionality work as expected. Validate both successful scenarios and error cases, especially handling of invalid course IDs.
  ```python
  def test_assign_courses():
      # Test logic

  def test_get_courses():
      # Test logic

  def test_assign_invalid_course():
      # Test logic
  ```

### Update Main Application

- [ ] **Integrate New Router into Main FastAPI App**
  - **File**: `src/main.py`
  - **Description**: Import and include the new student router to make the API endpoints accessible.
  ```python
  from fastapi import FastAPI
  from .routes.student import router as student_router

  app.include_router(student_router)
  ```

### Documentation

- [ ] **Verify API Documentation is Generated for New Endpoints**
  - **File**: N/A (automatically generated by FastAPI)
  - **Description**: Ensure that the FastAPI Swagger documentation reflects the new endpoints for assigning and retrieving courses.

### Deployment

- [ ] **Update Docker Configurations for Database Migrations**
  - **File**: `docker-compose.yml`
  - **Description**: Ensure that the Docker setup allows for Alembic migrations to be run in the PostgreSQL container.

---

## Dependencies:

- Task **Create the Student-Course Linking Table Model** must be completed before **Create Database Migration for `student_courses` Table** can begin.
- Task **Develop API Routes for Course Assignment** is dependent on the completion of the **Create Database Migration for `student_courses` Table** task.
- Task **Create Unit Tests for New API Endpoints** can only start after the **Develop API Routes for Course Assignment** task is completed.
- Task **Integrate New Router into Main FastAPI App** should be completed after the **Develop API Routes for Course Assignment** task is finished.
- Task **Verify API Documentation is Generated for New Endpoints** should be checked after the API development is complete.
- Task **Update Docker Configurations for Database Migrations** can proceed alongside other tasks but must be ready for deployment.

--- 

This structured task list ensures that the implementation is broken down into file-scoped, independent tasks that can be executed and tested one at a time, adhering to the project's coding standards and principles.