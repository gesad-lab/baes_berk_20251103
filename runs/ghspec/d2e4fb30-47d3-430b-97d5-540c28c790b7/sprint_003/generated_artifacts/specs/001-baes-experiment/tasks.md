# Tasks: Create Course Entity

---
## INCREMENTAL DEVELOPMENT CONTEXT

Existing Code to Build Upon:
- `tests/test_students.py` (2377 bytes)

---

## Task Breakdown

### Setup Tasks

- [ ] **Task 1**: Setup Project Environment  
  **File**: `docker-compose.yml`  
  Ensure Docker is configured for PostgreSQL as per previous implementations. Validate that services are correctly defined.  
  
- [ ] **Task 2**: Define Database Model for Course  
  **File**: `src/models/course.py`  
  Create a new `Course` model to represent the `courses` table in the database.  
  ```python
  from sqlalchemy import Column, Integer, String
  from sqlalchemy.ext.declarative import declarative_base

  Base = declarative_base()

  class Course(Base):
      __tablename__ = 'courses'
      
      id = Column(Integer, primary_key=True, autoincrement=True)
      name = Column(String(255), nullable=False)
      level = Column(String(255), nullable=False)
  ```

### Database Migration Tasks

- [ ] **Task 3**: Create Database Migration Script  
  **File**: `migrations/versions/<timestamp>_add_course_table.py`  
  Implement a migration script using Alembic to create the `courses` table. Ensure that existing student data is not affected.  
  ```python
  def upgrade():
      op.create_table(
          'courses',
          sa.Column('id', sa.Integer(), primary_key=True, autoincrement=True),
          sa.Column('name', sa.String(length=255), nullable=False),
          sa.Column('level', sa.String(length=255), nullable=False)
      )

  def downgrade():
      op.drop_table('courses')
  ```

### API Development Tasks

- [ ] **Task 4**: Implement API Router for Course Management  
  **File**: `src/routes/course.py`  
  Create a new API router handling course creation and retrieval. Define the `/courses` endpoint.  
  ```python
  from fastapi import APIRouter, HTTPException, Depends
  from pydantic import BaseModel
  from sqlalchemy.orm import Session
  from ..models.course import Course
  from ..database import get_db

  router = APIRouter()

  class CourseCreate(BaseModel):
      name: str
      level: str

  @router.post("/courses", response_model=CourseCreate)
  async def create_course(course: CourseCreate, db: Session = Depends(get_db)):
      if not course.name or not course.level:
          raise HTTPException(status_code=400, detail="Name and level are required")
      new_course = Course(name=course.name, level=course.level)
      db.add(new_course)
      db.commit()
      db.refresh(new_course)
      return new_course

  @router.get("/courses", response_model=List[CourseCreate])
  async def get_courses(db: Session = Depends(get_db)):
      return db.query(Course).all()
  ```

- [ ] **Task 5**: Update Main Application to Include Course API  
  **File**: `src/main.py`  
  Ensure the course router is included in the main FastAPI application setup.  
  ```python
  from fastapi import FastAPI
  from .routes.course import router as course_router

  app = FastAPI()

  app.include_router(course_router)
  ```

### Testing Tasks

- [ ] **Task 6**: Create Unit Tests for Course API  
  **File**: `tests/test_courses.py`  
  Construct tests for the course API endpoints. Validate both success and error conditions.  
  ```python
  from fastapi.testclient import TestClient
  from your_project.main import app

  client = TestClient(app)

  def test_create_course():
      response = client.post("/courses", json={"name": "Math 101", "level": "Beginner"})
      assert response.status_code == 201

  def test_create_course_missing_fields():
      response = client.post("/courses", json={"name": "Math 101"})
      assert response.status_code == 400

  def test_get_courses():
      response = client.get("/courses")
      assert response.status_code == 200
  ```

### Documentation Tasks

- [ ] **Task 7**: Update API Documentation  
  **File**: Automatically handled by FastAPI  
  Ensure that the `/courses` endpoints are accurately represented in the API documentation generated by FastAPI.

### Deployment Task

- [ ] **Task 8**: Validate Entire Feature during Deployment  
  **File**: `docker-compose.yml`  
  Update if necessary and run migrations on local and production environments to ensure successful application startup with new schema.

---

### Success Criteria
- Ensure that each task fully implements the new functionality for the Course entity, fulfills all requirements outlined in the specifications, and meets the established success criteria.

This breakdown creates clear, actionable tasks that can be executed and tested independently, ensuring the integration of the new Course entity is efficient and effective.