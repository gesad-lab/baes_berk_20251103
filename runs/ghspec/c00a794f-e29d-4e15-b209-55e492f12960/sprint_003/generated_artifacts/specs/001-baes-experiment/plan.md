# Implementation Plan: Create Course Entity

---
## INCREMENTAL DEVELOPMENT CONTEXT

Previous Sprint Plan:
# Implementation Plan: Add Email Field to Student Entity

---
## INCREMENTAL DEVELOPMENT CONTEXT

Previous Sprint Plan:
# Implementation Plan: Student Entity Web Application

---

## Version
**Version**: 1.1.0  
**Date**: 2023-10-10

---

## 1. Project Overview
The purpose of this feature is to introduce a new Course entity within the existing system architecture. This addition will allow for the management of various educational courses, enhancing the curriculum offerings by categorizing courses through essential attributes. The Course entity will consist of a name and a level, interfacing smoothly with the existing Student entity structure to ensure seamless data interactions.

---

## 2. Technical Architecture

### 2.1 Overall Architecture
- **Architecture Pattern**: Microservices architecture that maintains services responsible for `Student` and now also integrates `Course`.
- **Tech Stack**: 
  - **Web Framework**: FastAPI (lightweight and asynchronous capabilities)
  - **Database**: SQLite (for local use and simplicity)
  - **ORM**: SQLAlchemy (for database interactions)
  - **Testing**: pytest (for testing functionalities)
  - **Dependency Management**: Poetry (for simplified package management)
  - **API Documentation**: OpenAPI (auto-generated by FastAPI)

### 2.2 Module Boundaries
- **Student Service** Module:
  - Continues to handle all CRUD operations related to student entities.
  
- **Course Service** Module (New):
  - Handles all CRUD operations related to course entities.
  - Responsible for API routes, database connection, and data validation for courses.

---

## 3. Implementation Approach

### 3.1 Directory Structure
```plaintext
student_entity_app/
│
├── src/
│   ├── __init__.py
│   ├── main.py                     # Entry point for the application
│   ├── models.py                   # Database models (SQLAlchemy)
│   ├── schemas.py                  # Data validation schemas (Pydantic)
│   ├── routes/
│   │   ├── __init__.py
│   │   ├── student_routes.py        # API routes for student endpoints
│   │   ├── course_routes.py         # API routes for course endpoints (new)
│   └── database.py                  # Database connection and initialization
│
├── tests/
│   ├── __init__.py
│   ├── test_student.py              # Test cases for student routes
│   └── test_course.py               # Test cases for course routes (new)
│
├── config/
│   └── .env                         # Environment variables
│
├── requirements.txt                 # Dependencies file
└── README.md                        # Project documentation
```

### 3.2 Database Model
#### New Course Model Definition
```python
# models.py
from sqlalchemy import Column, Integer, String
from database import Base

class Course(Base):
    __tablename__ = 'courses'
    
    id = Column(Integer, primary_key=True, autoincrement=True)
    name = Column(String, nullable=False)  # Name of the course
    level = Column(String, nullable=False)  # Level of the course
```

### 3.3 API Endpoints
- **POST /courses**
  - **Request**: JSON body with required fields `name` (string) and `level` (string).
  - **Response**: JSON with success message or detailed error message for missing inputs.
  
- **GET /courses**
  - **Response**: JSON array containing all courses with their names and levels.

### 3.4 Application Startup
- Extend **SQLAlchemy** functionality to include the creation of the `courses` table within the schema upon application startup, ensuring proper migrations are executed automatically.

### 3.5 Error Handling
- Implement input validation for both `name` and `level` fields in the POST endpoint.
- Return appropriate structured JSON error messages if validation fails, especially for missing fields.

---

## 4. Testing Approach

### 4.1 Test Coverage
- Target a minimum of 70% coverage across all modules, with critical paths (adding and retrieving courses) targeting 90% coverage.

### 4.2 Test Types
- **Unit Tests**: Test individual functions and methods in `routes` and models modules for courses.
- **Integration Tests**: Test the interaction with the SQLite database, focusing on positive and negative test cases for courses.
- **Contract Tests**: Ensure the API endpoints return the expected responses and status codes after modifications.

### 4.3 Testing Structure
- Organize tests to mirror the structure of source code, ensuring new tests cover validation of course creation and retrieval.

```python
# tests/test_course.py
import pytest

def test_add_course_with_valid_data(client):
    response = client.post("/courses", json={"name": "Math 101", "level": "beginner"})
    assert response.status_code == 200
    assert response.json() == {"message": "Course added successfully"}

def test_add_course_without_level(client):
    response = client.post("/courses", json={"name": "Math 101"})
    assert response.status_code == 400
    assert response.json() == {"error": {"code": "E001", "message": "Level is required."}}
```

---

## 5. Error Handling & Validation
- Validate incoming requests to ensure both `name` and `level` fields are provided when creating a course.
- Return structured error responses with appropriate HTTP status codes.

```json
{
  "error": {
    "code": "E001",
    "message": "Level is required."
  }
}
```

---

## 6. API Design Considerations
- Follow RESTful design principles, using nouns for endpoints (`/courses`).
- Ensure meaningful HTTP status codes and provide consistent error messages.

---

## 7. Database Migration Strategy
- Leverage Alembic to create a migration script that adds the `courses` table while ensuring that existing data integrity for the `students` table is preserved.

### Migration Script Example
```python
# migrations/versions/xxxx_create_courses_table.py
from alembic import op
import sqlalchemy as sa

def upgrade():
    op.create_table(
        'courses',
        sa.Column('id', sa.Integer(), primary_key=True, autoincrement=True),
        sa.Column('name', sa.String(), nullable=False),
        sa.Column('level', sa.String(), nullable=False)
    )

def downgrade():
    op.drop_table('courses')
```

---

## 8. Logging & Monitoring
Implement structured logging to capture relevant events related to course creation and retrieval, enhancing traceability and monitoring.

---

## 9. Documentation
Update the `README.md` to cover the new Course entity, including installation instructions, usage, updated API endpoints, and examples for interaction.

---

## 10. Success Criteria Check
1. **Course Creation**: Ensure at least one course can be created successfully with both `name` and `level`.
2. **Courses Retrieval**: Confirm that querying for courses returns an array containing names and levels.
3. **Error Handling**: Validate that appropriate errors return for invalid requests (e.g., missing level).
4. **Database Initialization**: Verify successful creation of the courses table via migration without impacting existing data.
5. **Backward Compatibility**: Ensure existing student data remains intact and operable.

---

This implementation plan outlines the necessary steps for integrating the new Course entity while adhering to existing architectural principles and practices. By maintaining modular boundaries and ensuring backward compatibility, the implementation will enhance the application's educational offerings effectively.